import{_ as P,r as _,k as le,n as W,c as H,o as y,e as a,b as t,w as o,d as v,J as E,f as F,T as re,U as oe,h as A,F as X,D as Y,p as O,z as S,s as J,V as de,W as ce,X as me,N as pe,Y as ve,Z as fe,H as _e,x as ae,E as B,a as ge,$ as he,v as ye,u as Ce,O as te}from"./index-EVT6KDgg.js";import{c as be,b as xe,d as Ve,m as we}from"./mail-2gzdnJds.js";const ke={class:"rich-editor"},ze={class:"editor-toolbar"},$e=["placeholder"],Me={__name:"RichEditor",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:"请输入邮件正文..."}},emits:["update:modelValue"],setup(U,{expose:T,emit:N}){const x=U,k=N,c=_(null),r=_("3"),h=_("#000000"),V=_(!1),s=_(""),C=_(""),p=_(null);le(()=>{x.modelValue&&c.value&&(c.value.innerHTML=x.modelValue)}),W(()=>x.modelValue,d=>{c.value&&c.value.innerHTML!==d&&(c.value.innerHTML=d)});const m=(d,l=null)=>{var f;(f=c.value)==null||f.focus(),document.execCommand(d,!1,l)},z=d=>document.queryCommandState(d),j=()=>{},L=()=>{var d;k("update:modelValue",((d=c.value)==null?void 0:d.innerHTML)||"")},w=d=>{d.preventDefault();const l=d.clipboardData.getData("text/html")||d.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,l)},q=d=>{var f;(f=c.value)==null||f.focus();const l=window.getSelection();l&&l.rangeCount>0&&document.execCommand("fontSize",!1,d)},n=d=>{m("foreColor",d)},e=()=>{if(C.value){const d=`<a href="${C.value}" target="_blank">${s.value||C.value}</a>`;m("insertHTML",d)}V.value=!1,s.value="",C.value=""},u=()=>{var d;(d=p.value)==null||d.click()},b=d=>{const l=d.target.files[0];if(l){const f=new FileReader;f.onload=M=>{const R=`<img src="${M.target.result}" style="max-width: 100%;" />`;m("insertHTML",R)},f.readAsDataURL(l)}d.target.value=""};return T({getContent:()=>{var d;return((d=c.value)==null?void 0:d.innerHTML)||""},setContent:d=>{c.value&&(c.value.innerHTML=d)},clear:()=>{c.value&&(c.value.innerHTML="")}}),(d,l)=>{const f=v("el-button"),M=v("el-tooltip"),R=v("el-button-group"),K=v("el-divider"),D=v("el-option"),ne=v("el-select"),se=v("el-color-picker"),Z=v("el-icon"),Q=v("el-input"),ee=v("el-form-item"),ue=v("el-form"),ie=v("el-dialog");return y(),H("div",ke,[a("div",ze,[t(R,null,{default:o(()=>[t(M,{content:"加粗"},{default:o(()=>[t(f,{class:E({active:z("bold")}),onClick:l[0]||(l[0]=g=>m("bold"))},{default:o(()=>[...l[16]||(l[16]=[a("span",{class:"icon-text bold"},"B",-1)])]),_:1},8,["class"])]),_:1}),t(M,{content:"斜体"},{default:o(()=>[t(f,{class:E({active:z("italic")}),onClick:l[1]||(l[1]=g=>m("italic"))},{default:o(()=>[...l[17]||(l[17]=[a("span",{class:"icon-text italic"},"I",-1)])]),_:1},8,["class"])]),_:1}),t(M,{content:"下划线"},{default:o(()=>[t(f,{class:E({active:z("underline")}),onClick:l[2]||(l[2]=g=>m("underline"))},{default:o(()=>[...l[18]||(l[18]=[a("span",{class:"icon-text underline"},"U",-1)])]),_:1},8,["class"])]),_:1}),t(M,{content:"删除线"},{default:o(()=>[t(f,{class:E({active:z("strikeThrough")}),onClick:l[3]||(l[3]=g=>m("strikeThrough"))},{default:o(()=>[...l[19]||(l[19]=[a("span",{class:"icon-text strikethrough"},"S",-1)])]),_:1},8,["class"])]),_:1})]),_:1}),t(K,{direction:"vertical"}),t(ne,{modelValue:r.value,"onUpdate:modelValue":l[4]||(l[4]=g=>r.value=g),placeholder:"字号",style:{width:"90px"},size:"small",onChange:q},{default:o(()=>[t(D,{label:"小",value:"2"}),t(D,{label:"正常",value:"3"}),t(D,{label:"大",value:"4"}),t(D,{label:"较大",value:"5"}),t(D,{label:"很大",value:"6"}),t(D,{label:"最大",value:"7"})]),_:1},8,["modelValue"]),t(se,{modelValue:h.value,"onUpdate:modelValue":l[5]||(l[5]=g=>h.value=g),size:"small",onChange:n},null,8,["modelValue"]),t(K,{direction:"vertical"}),t(R,null,{default:o(()=>[t(M,{content:"左对齐"},{default:o(()=>[t(f,{onClick:l[6]||(l[6]=g=>m("justifyLeft"))},{default:o(()=>[...l[20]||(l[20]=[a("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor"},[a("path",{d:"M3 3h18v2H3V3zm0 4h12v2H3V7zm0 4h18v2H3v-2zm0 4h12v2H3v-2zm0 4h18v2H3v-2z"})],-1)])]),_:1})]),_:1}),t(M,{content:"居中"},{default:o(()=>[t(f,{onClick:l[7]||(l[7]=g=>m("justifyCenter"))},{default:o(()=>[...l[21]||(l[21]=[a("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor"},[a("path",{d:"M3 3h18v2H3V3zm3 4h12v2H6V7zm-3 4h18v2H3v-2zm3 4h12v2H6v-2zm-3 4h18v2H3v-2z"})],-1)])]),_:1})]),_:1}),t(M,{content:"右对齐"},{default:o(()=>[t(f,{onClick:l[8]||(l[8]=g=>m("justifyRight"))},{default:o(()=>[...l[22]||(l[22]=[a("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor"},[a("path",{d:"M3 3h18v2H3V3zm6 4h12v2H9V7zm-6 4h18v2H3v-2zm6 4h12v2H9v-2zm-6 4h18v2H3v-2z"})],-1)])]),_:1})]),_:1})]),_:1}),t(K,{direction:"vertical"}),t(R,null,{default:o(()=>[t(M,{content:"无序列表"},{default:o(()=>[t(f,{onClick:l[9]||(l[9]=g=>m("insertUnorderedList"))},{default:o(()=>[...l[23]||(l[23]=[a("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor"},[a("path",{d:"M4 4h2v2H4V4zm4 0h12v2H8V4zM4 10h2v2H4v-2zm4 0h12v2H8v-2zM4 16h2v2H4v-2zm4 0h12v2H8v-2z"})],-1)])]),_:1})]),_:1}),t(M,{content:"有序列表"},{default:o(()=>[t(f,{onClick:l[10]||(l[10]=g=>m("insertOrderedList"))},{default:o(()=>[...l[24]||(l[24]=[a("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor"},[a("path",{d:"M3 4h2v2H3V4zm4 0h12v2H7V4zM3 10h2v2H3v-2zm4 0h12v2H7v-2zM3 16h2v2H3v-2zm4 0h12v2H7v-2z"}),a("text",{x:"3.5",y:"5.5","font-size":"4",fill:"currentColor"},"1"),a("text",{x:"3.5",y:"11.5","font-size":"4",fill:"currentColor"},"2"),a("text",{x:"3.5",y:"17.5","font-size":"4",fill:"currentColor"},"3")],-1)])]),_:1})]),_:1})]),_:1}),t(K,{direction:"vertical"}),t(M,{content:"插入链接"},{default:o(()=>[t(f,{onClick:l[11]||(l[11]=g=>V.value=!0)},{default:o(()=>[t(Z,null,{default:o(()=>[t(F(re))]),_:1})]),_:1})]),_:1}),t(M,{content:"插入图片"},{default:o(()=>[t(f,{onClick:u},{default:o(()=>[t(Z,null,{default:o(()=>[t(F(oe))]),_:1})]),_:1})]),_:1}),a("input",{ref_key:"imageInput",ref:p,type:"file",accept:"image/*",style:{display:"none"},onChange:b},null,544)]),a("div",{ref_key:"editorRef",ref:c,class:"editor-content",contenteditable:"true",onInput:L,onPaste:w,onMouseup:j,onKeyup:j,placeholder:U.placeholder},null,40,$e),t(ie,{modelValue:V.value,"onUpdate:modelValue":l[15]||(l[15]=g=>V.value=g),title:"插入链接",width:"400px"},{footer:o(()=>[t(f,{onClick:l[14]||(l[14]=g=>V.value=!1)},{default:o(()=>[...l[25]||(l[25]=[A("取消",-1)])]),_:1}),t(f,{type:"primary",onClick:e},{default:o(()=>[...l[26]||(l[26]=[A("确定",-1)])]),_:1})]),default:o(()=>[t(ue,null,{default:o(()=>[t(ee,{label:"链接文本"},{default:o(()=>[t(Q,{modelValue:s.value,"onUpdate:modelValue":l[12]||(l[12]=g=>s.value=g),placeholder:"请输入链接文本"},null,8,["modelValue"])]),_:1}),t(ee,{label:"链接地址"},{default:o(()=>[t(Q,{modelValue:C.value,"onUpdate:modelValue":l[13]||(l[13]=g=>C.value=g),placeholder:"https://"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},He=P(Me,[["__scopeId","data-v-d429d1b4"]]),Ie={class:"contact-select"},Se={class:"contact-option"},Be={class:"contact-info"},Ae={class:"contact-name"},Ue={class:"contact-email"},Le={__name:"ContactSelect",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(U,{emit:T}){const N=U,x=T,k=_([...N.modelValue]),c=_([]),r=_(!1);W(()=>N.modelValue,p=>{k.value=[...p]},{deep:!0});const h=async p=>{if(!p){c.value=[];return}r.value=!0;try{const m=localStorage.getItem("userId");if(m){const z=await be.search(m,p);c.value=Array.isArray(z)?z:[]}else c.value=[]}catch(m){console.error("搜索联系人失败",m),c.value=[]}finally{r.value=!1}},V=p=>p.contactName&&p.contactName!==p.email?`${p.contactName} <${p.email}>`:p.email,s=p=>(p.contactName||p.email).charAt(0).toUpperCase(),C=p=>{x("update:modelValue",p)};return(p,m)=>{const z=v("el-avatar"),j=v("el-option"),L=v("el-select");return y(),H("div",Ie,[t(L,{modelValue:k.value,"onUpdate:modelValue":m[0]||(m[0]=w=>k.value=w),multiple:"",filterable:"",remote:"","reserve-keyword":"","remote-method":h,loading:r.value,placeholder:"输入邮箱或姓名搜索联系人",style:{width:"100%"},"allow-create":"","default-first-option":"",onChange:C},{default:o(()=>[(y(!0),H(X,null,Y(c.value,w=>(y(),O(j,{key:w.id||w.email,label:V(w),value:w.email},{default:o(()=>[a("div",Se,[t(z,{size:28},{default:o(()=>[A(S(s(w)),1)]),_:2},1024),a("div",Be,[a("span",Ae,S(w.contactName||w.email),1),a("span",Ue,S(w.email),1)])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"])])}}},G=P(Le,[["__scopeId","data-v-e688766e"]]),Te={class:"attachment-upload"},Ne={key:0,class:"upload-trigger"},je={class:"upload-text"},Fe={class:"upload-tip"},De={key:0,class:"attachment-list"},Re={class:"list-header"},Ee={class:"attachment-items"},Oe={class:"file-info"},Je=["title"],qe={class:"file-size"},Ke={key:1,class:"quick-add"},Pe={__name:"AttachmentUpload",props:{modelValue:{type:Array,default:()=>[]},maxSizeMB:{type:Number,default:25},maxCount:{type:Number,default:10}},emits:["update:modelValue"],setup(U,{expose:T,emit:N}){const x=U,k=N,c=_(null),r=_([]),h=_(!1);W(()=>x.modelValue,n=>{r.value=n.map(e=>({...e,uid:e.uid||Date.now()+Math.random()}))},{immediate:!0,deep:!0});const V=async(n,e)=>{if(e.length>x.maxCount){B.warning(`最多只能上传 ${x.maxCount} 个文件`);return}if(n.size>x.maxSizeMB*1024*1024){B.warning(`文件 "${n.name}" 超过 ${x.maxSizeMB}MB 限制`),e.pop();return}r.value=e,n.status==="ready"&&n.raw&&await s(n)},s=async n=>{const e=r.value.findIndex(u=>u.uid===n.uid);if(e!==-1){r.value[e].status="uploading",r.value[e].percentage=0;try{const u=await xe.upload(n.raw,b=>{r.value[e]&&(r.value[e].percentage=b)});r.value[e].status="success",r.value[e].id=u.data.id,r.value[e].percentage=100,m(),B.success(`${n.name} 上传成功`)}catch(u){console.error("上传失败:",u),r.value[e].status="fail",B.error(`${n.name} 上传失败`)}}},C=n=>{const e=r.value.findIndex(u=>u.uid===n.uid);e>-1&&(r.value.splice(e,1),m())},p=n=>n.size>x.maxSizeMB*1024*1024?(B.warning(`文件 "${n.name}" 超过 ${x.maxSizeMB}MB 限制`),!1):!0,m=()=>{const n=r.value.map(e=>({uid:e.uid,name:e.name,size:e.size,id:e.id,status:e.status}));k("update:modelValue",n)},z=n=>{if(!n)return"0 B";const e=1024,u=["B","KB","MB","GB"],b=Math.floor(Math.log(n)/Math.log(e));return parseFloat((n/Math.pow(e,b)).toFixed(2))+" "+u[b]},j=n=>{var u;const e=(u=n.name.split(".").pop())==null?void 0:u.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp","svg"].includes(e)?oe:["mp4","avi","mov","wmv","flv","mkv"].includes(e)?ve:["mp3","wav","flac","aac","ogg"].includes(e)?fe:["zip","rar","7z","tar","gz"].includes(e)?_e:ae},L=n=>{var u;const e=(u=n.name.split(".").pop())==null?void 0:u.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp","svg"].includes(e)?"#67C23A":["pdf"].includes(e)?"#F56C6C":["doc","docx"].includes(e)?"#409EFF":["xls","xlsx"].includes(e)?"#67C23A":["ppt","pptx"].includes(e)?"#E6A23C":["zip","rar","7z"].includes(e)?"#909399":"#409EFF"};return T({getRawFiles:()=>r.value.map(n=>n.raw||n),clear:()=>{r.value=[],k("update:modelValue",[])}}),(n,e)=>{const u=v("el-icon"),b=v("el-upload"),I=v("el-button"),$=v("el-progress");return y(),H("div",Te,[t(b,{ref_key:"uploadRef",ref:c,"auto-upload":!1,"file-list":r.value,"on-change":V,"on-remove":C,"before-upload":p,multiple:"",drag:"",class:E({"hide-upload":!h.value})},{default:o(()=>[h.value?(y(),H("div",Ne,[t(u,{size:40},{default:o(()=>[t(F(de))]),_:1}),a("div",je,[e[2]||(e[2]=a("p",null,[A("将文件拖拽到此处，或 "),a("em",null,"点击上传")],-1)),a("p",Fe,"单个文件不超过 "+S(U.maxSizeMB)+"MB，最多上传 "+S(U.maxCount)+" 个文件",1)])])):J("",!0)]),_:1},8,["file-list","class"]),r.value.length>0?(y(),H("div",De,[a("div",Re,[a("span",null,"附件 ("+S(r.value.length)+")",1),t(I,{link:"",type:"primary",onClick:e[0]||(e[0]=i=>h.value=!h.value)},{default:o(()=>[A(S(h.value?"收起":"添加更多"),1)]),_:1})]),a("div",Ee,[(y(!0),H(X,null,Y(r.value,(i,d)=>(y(),H("div",{key:i.uid,class:"attachment-item"},[t(u,{size:24,color:L(i)},{default:o(()=>[(y(),O(ce(j(i))))]),_:2},1032,["color"]),a("div",Oe,[a("span",{class:"file-name",title:i.name},S(i.name),9,Je),a("span",qe,S(z(i.size)),1)]),i.status==="uploading"?(y(),O($,{key:0,percentage:i.percentage||0,"stroke-width":4,style:{width:"100px"}},null,8,["percentage"])):(y(),O(u,{key:1,class:"remove-btn",onClick:l=>C(i)},{default:o(()=>[t(F(me))]),_:1},8,["onClick"]))]))),128))])])):J("",!0),!h.value&&r.value.length===0?(y(),H("div",Ke,[t(I,{icon:F(pe),onClick:e[1]||(e[1]=i=>h.value=!0)},{default:o(()=>[...e[3]||(e[3]=[A(" 添加附件 ",-1)])]),_:1},8,["icon"])])):J("",!0)])}}},Ge=P(Pe,[["__scopeId","data-v-f0ea934d"]]),We={class:"compose-container"},Xe={class:"compose-toolbar"},Ye={class:"toolbar-actions"},Ze={class:"compose-form"},Qe={class:"form-row"},et={class:"input-wrapper"},tt={class:"form-row"},lt={class:"input-wrapper"},ot={key:0,class:"form-row"},at={key:1,class:"form-row"},nt={class:"form-row"},st={class:"form-row attachments-row"},ut={class:"editor-wrapper"},it={__name:"Compose",setup(U){const T=Ce(),N=_(null),x=_(null),k=_(!1),c=_(!1),r=_(!1),h=_([]),V=_(null),s=ge({to:[],cc:[],bcc:[],subject:"",body:""}),C=_([]),p=()=>{k.value=!k.value},m=async()=>{var n,e;if(s.to.length===0){B.warning("请输入收件人");return}if(!s.subject.trim())try{await te.confirm("邮件主题为空，确定要发送吗？","提示",{confirmButtonText:"发送",cancelButtonText:"取消",type:"warning"})}catch{return}c.value=!0;try{const u=localStorage.getItem("userId"),b=C.value.filter($=>$.id).map($=>$.id),I={userId:u,toAddress:s.to.join(","),ccAddress:s.cc.length>0?s.cc.join(","):null,bccAddress:s.bcc.length>0?s.bcc.join(","):null,subject:s.subject||"(无主题)",content:s.body,plainContent:s.body.replace(/<[^>]*>/g,""),attachmentIds:b};await we.send(I),B.success("邮件发送成功"),T.push("/sent")}catch(u){console.error("发送邮件失败",u),B.error(((e=(n=u.response)==null?void 0:n.data)==null?void 0:e.message)||"发送失败，请重试")}finally{c.value=!1}},z=async()=>{r.value=!0;try{localStorage.setItem("mail_draft",JSON.stringify({...s,savedAt:new Date().toISOString()})),B.success("草稿已保存到本地")}catch(n){console.error("保存草稿失败",n),B.error("保存失败")}finally{r.value=!1}},j=async()=>{if(s.to.length>0||s.subject.trim()||s.body.trim()||C.value.length>0)try{await te.confirm("确定要放弃编辑吗？未保存的内容将丢失。","提示",{confirmButtonText:"放弃",cancelButtonText:"继续编辑",type:"warning"})}catch{return}T.back()};let L=null;const w=()=>{L=setInterval(()=>{(s.to.length>0||s.subject||s.body)&&localStorage.setItem("mail_draft_auto",JSON.stringify({...s,attachmentNames:C.value.map(n=>n.name),savedAt:new Date().toISOString()}))},3e4)};he(()=>{L&&clearInterval(L)}),w();const q=async()=>{const n=localStorage.getItem("userId"),e=localStorage.getItem("email")||"",u=localStorage.getItem("username")||"默认账号";let b=[];if(n)try{b=await Ve.listByUser(n)||[]}catch($){console.error("加载邮箱账号失败",$)}!b.length&&e&&(b=[{id:"fallback-account",emailAddress:e,displayName:u,isDefault:!0,isFallback:!0}]),h.value=b;const I=h.value.find($=>$.isDefault);I?V.value=I.id:h.value.length>0?V.value=h.value[0].id:V.value=null};return le(()=>{q()}),(n,e)=>{const u=v("el-button"),b=v("el-option"),I=v("el-select"),$=v("el-input");return y(),H("div",We,[a("div",Xe,[t(u,{onClick:j},{default:o(()=>[...e[7]||(e[7]=[A("取消",-1)])]),_:1}),a("div",Ye,[t(u,{icon:F(ae),onClick:z,loading:r.value},{default:o(()=>[...e[8]||(e[8]=[A(" 存草稿 ",-1)])]),_:1},8,["icon","loading"]),t(u,{type:"primary",icon:F(ye),onClick:m,loading:c.value},{default:o(()=>[...e[9]||(e[9]=[A(" 发送 ",-1)])]),_:1},8,["icon","loading"])])]),a("div",Ze,[a("div",Qe,[e[10]||(e[10]=a("label",null,"发件人",-1)),a("div",et,[t(I,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=i=>V.value=i),placeholder:"默认发件邮箱",style:{width:"260px"}},{default:o(()=>[(y(!0),H(X,null,Y(h.value,i=>(y(),O(b,{key:i.id,label:i.displayName?`${i.displayName} <${i.emailAddress}>`:i.emailAddress,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a("div",tt,[e[11]||(e[11]=a("label",null,"收件人",-1)),a("div",lt,[t(G,{modelValue:s.to,"onUpdate:modelValue":e[1]||(e[1]=i=>s.to=i)},null,8,["modelValue"]),t(u,{link:"",size:"small",onClick:p},{default:o(()=>[A(S(k.value?"隐藏":"抄送/密送"),1)]),_:1})])]),k.value?(y(),H("div",ot,[e[12]||(e[12]=a("label",null,"抄送",-1)),t(G,{modelValue:s.cc,"onUpdate:modelValue":e[2]||(e[2]=i=>s.cc=i)},null,8,["modelValue"])])):J("",!0),k.value?(y(),H("div",at,[e[13]||(e[13]=a("label",null,"密送",-1)),t(G,{modelValue:s.bcc,"onUpdate:modelValue":e[3]||(e[3]=i=>s.bcc=i)},null,8,["modelValue"])])):J("",!0),a("div",nt,[e[14]||(e[14]=a("label",null,"主题",-1)),t($,{modelValue:s.subject,"onUpdate:modelValue":e[4]||(e[4]=i=>s.subject=i),placeholder:"请输入邮件主题",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),a("div",st,[t(Ge,{modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=i=>C.value=i),ref_key:"attachmentRef",ref:x},null,8,["modelValue"])]),a("div",ut,[t(He,{modelValue:s.body,"onUpdate:modelValue":e[6]||(e[6]=i=>s.body=i),ref_key:"editorRef",ref:N,placeholder:"请输入邮件正文..."},null,8,["modelValue"])])])])}}},ct=P(it,[["__scopeId","data-v-0751a2f6"]]);export{ct as default};
