import{_ as K,j as Q,r as y,i as D,k as W,c,o as u,b as n,e as s,w as i,d as f,F as B,f as r,P as X,Q as Y,B as Z,s as S,z as _,J as ee,L as te,M as ae,D as se,v as x,E as d,u as ne,I as oe,h as m,y as le,H as re,R as ie,N as de,x as ce,S as ue,O as _e}from"./index-Dwetklps.js";import{m as g,b as me}from"./mail-BVuPHEDu.js";const ve={class:"mail-detail-container"},fe={key:0,class:"loading-container"},pe={class:"detail-toolbar"},ye={class:"nav-buttons"},he={class:"mail-content"},ge={class:"mail-header"},we={class:"mail-subject"},ke={class:"mail-meta"},be={class:"meta-info"},Ce={class:"sender-line"},Se={class:"sender-name"},Ae={class:"sender-email"},De={class:"recipient-line"},Be={class:"mail-time"},xe=["innerHTML"],Me={key:0,class:"mail-attachments"},ze={class:"attachments-header"},Le={class:"attachment-list"},Ne={class:"attachment-info"},Re={class:"attachment-name"},Ie={class:"attachment-size"},$e={key:1,class:"draft-actions"},je={class:"draft-buttons"},Te={key:2,class:"quick-reply"},Ve={class:"reply-actions"},Ee={key:2,class:"empty-container"},Fe={__name:"MailDetail",setup(Ue){const M=Q(),A=ne(),w=M.params.id,k=y(!0),b=y(!1),C=y(!1),a=y(null),h=y([]),p=y(""),z=D(()=>{var e;return((e=a.value)==null?void 0:e.folder)==="inbox"}),L=D(()=>{var e;return((e=a.value)==null?void 0:e.folder)==="drafts"}),N=e=>e?e.split("@")[0].charAt(0).toUpperCase():"?",R=e=>e?e.split("@")[0]:"未知",I=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",$=e=>{if(!e)return"0 B";const t=["B","KB","MB","GB"];let l=0;for(;e>=1024&&l<t.length-1;)e/=1024,l++;return`${e.toFixed(l>0?1:0)} ${t[l]}`},j=async()=>{k.value=!0;try{const e=await g.get(w);a.value=e.mail,h.value=e.attachments||[]}catch(e){console.error("加载邮件详情失败:",e),d.error("加载邮件详情失败")}finally{k.value=!1}},T=async()=>{try{await g.toggleStar(w),a.value.isStarred=!a.value.isStarred}catch(e){console.error("切换星标失败:",e),d.error("操作失败")}},V=async()=>{try{await _e.confirm("确定要删除这封邮件吗？","确认删除",{type:"warning"}),await g.delete(w),d.success("删除成功"),A.back()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),d.error("删除失败"))}},E=()=>{window.print()},F=async e=>{try{const t=await me.download(e.id),l=window.URL.createObjectURL(new Blob([t.data])),o=document.createElement("a");o.href=l,o.download=e.fileName,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(l)}catch(t){console.error("下载失败:",t),d.error("下载失败")}},U=async()=>{if(!p.value.trim()){d.warning("请输入回复内容");return}b.value=!0;try{const e=localStorage.getItem("userId");await g.send({userId:e,toAddress:a.value.fromAddress,subject:`Re: ${a.value.subject||"(无主题)"}`,content:p.value,plainContent:p.value}),d.success("回复发送成功"),p.value=""}catch(e){console.error("回复失败:",e),d.error("回复发送失败")}finally{b.value=!1}},H=async()=>{var e,t;if(a.value){if(!a.value.toAddress||!a.value.toAddress.trim()){d.warning("草稿缺少收件人，无法发送");return}C.value=!0;try{await g.sendDraft(a.value.id),d.success("草稿发送成功"),a.value.folder="sent",A.push("/sent")}catch(l){console.error("草稿发送失败:",l),d.error(((t=(e=l.response)==null?void 0:e.data)==null?void 0:t.message)||"草稿发送失败")}finally{C.value=!1}}};return W(()=>{j()}),(e,t)=>{const l=f("el-icon"),o=f("el-button"),O=f("el-button-group"),P=f("el-avatar"),q=f("el-alert"),G=f("el-input"),J=f("el-empty");return u(),c("div",ve,[k.value?(u(),c("div",fe,[n(l,{class:"is-loading",size:32},{default:i(()=>[n(r(oe))]),_:1}),t[3]||(t[3]=s("span",null,"加载中...",-1))])):a.value?(u(),c(B,{key:1},[s("div",pe,[n(o,{icon:r(X),onClick:t[0]||(t[0]=v=>e.$router.back())},{default:i(()=>[...t[4]||(t[4]=[m("返回",-1)])]),_:1},8,["icon"]),n(O,null,{default:i(()=>[n(o,{icon:r(le),onClick:V},{default:i(()=>[...t[5]||(t[5]=[m("删除",-1)])]),_:1},8,["icon"]),n(o,{icon:r(re)},{default:i(()=>[...t[6]||(t[6]=[m("移动",-1)])]),_:1},8,["icon"]),n(o,{icon:r(ie),onClick:E},{default:i(()=>[...t[7]||(t[7]=[m("打印",-1)])]),_:1},8,["icon"])]),_:1}),s("div",ye,[n(o,{icon:r(Y),circle:""},null,8,["icon"]),n(o,{icon:r(Z),circle:""},null,8,["icon"])])]),s("div",he,[s("div",ge,[s("h1",we,_(a.value.subject||"(无主题)"),1),s("div",ke,[n(P,{size:48},{default:i(()=>[m(_(N(a.value.fromAddress)),1)]),_:1}),s("div",be,[s("div",Ce,[s("span",Se,_(R(a.value.fromAddress)),1),s("span",Ae,"<"+_(a.value.fromAddress)+">",1)]),s("div",De,[s("span",null,"收件人："+_(a.value.toAddress),1),s("span",Be,_(I(a.value.receiveTime||a.value.sendTime)),1)])]),n(o,{icon:a.value.isStarred?r(te):r(ae),class:ee({starred:a.value.isStarred}),circle:"",onClick:T},null,8,["icon","class"])])]),s("div",{class:"mail-body",innerHTML:a.value.content||a.value.plainContent},null,8,xe),h.value&&h.value.length>0?(u(),c("div",Me,[s("div",ze,[n(l,null,{default:i(()=>[n(r(de))]),_:1}),s("span",null,"附件 ("+_(h.value.length)+")",1)]),s("div",Le,[(u(!0),c(B,null,se(h.value,v=>(u(),c("div",{class:"attachment-item",key:v.id},[n(l,{size:32,color:"#409EFF"},{default:i(()=>[n(r(ce))]),_:1}),s("div",Ne,[s("span",Re,_(v.fileName),1),s("span",Ie,_($(v.fileSize)),1)]),n(o,{type:"primary",link:"",icon:r(ue),onClick:He=>F(v)},{default:i(()=>[...t[8]||(t[8]=[m("下载",-1)])]),_:1},8,["icon","onClick"])]))),128))])])):S("",!0),L.value?(u(),c("div",$e,[n(q,{type:"info",closable:!1,title:"这是草稿，确认内容无误后即可发送"}),s("div",je,[n(o,{type:"primary",icon:r(x),loading:C.value,onClick:H},{default:i(()=>[...t[9]||(t[9]=[m("发送草稿",-1)])]),_:1},8,["icon","loading"])])])):S("",!0),z.value?(u(),c("div",Te,[n(G,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=v=>p.value=v),type:"textarea",rows:3,placeholder:"快速回复..."},null,8,["modelValue"]),s("div",Ve,[n(o,{type:"primary",icon:r(x),onClick:U,loading:b.value},{default:i(()=>[...t[10]||(t[10]=[m("发送",-1)])]),_:1},8,["icon","loading"])])])):S("",!0)])],64)):(u(),c("div",Ee,[n(J,{description:"邮件不存在或已被删除"}),n(o,{type:"primary",onClick:t[2]||(t[2]=v=>e.$router.back())},{default:i(()=>[...t[11]||(t[11]=[m("返回",-1)])]),_:1})]))])}}},qe=K(Fe,[["__scopeId","data-v-f531b230"]]);export{qe as default};
