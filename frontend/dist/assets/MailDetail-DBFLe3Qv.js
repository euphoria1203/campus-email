import{_ as F,j as U,r as y,k as H,c as m,o as p,b as n,e as a,w as r,d as f,F as C,f as l,P as O,Q as P,B as q,s as G,z as c,J,L as K,M as Q,D as W,v as X,E as u,u as Y,I as Z,h as _,y as ee,H as te,R as ae,N as ne,x as se,S as oe,O as le}from"./index-EVT6KDgg.js";import{m as g,b as re}from"./mail-2gzdnJds.js";const ie={class:"mail-detail-container"},ce={key:0,class:"loading-container"},de={class:"detail-toolbar"},ue={class:"nav-buttons"},_e={class:"mail-content"},me={class:"mail-header"},pe={class:"mail-subject"},ve={class:"mail-meta"},fe={class:"meta-info"},he={class:"sender-line"},ye={class:"sender-name"},ge={class:"sender-email"},we={class:"recipient-line"},ke={class:"mail-time"},be=["innerHTML"],Ce={key:0,class:"mail-attachments"},Se={class:"attachments-header"},Ae={class:"attachment-list"},Be={class:"attachment-info"},Me={class:"attachment-name"},ze={class:"attachment-size"},Le={class:"quick-reply"},Ne={class:"reply-actions"},Re={key:2,class:"empty-container"},xe={__name:"MailDetail",setup(De){const S=U(),A=Y(),w=S.params.id,k=y(!0),b=y(!1),s=y(null),h=y([]),v=y(""),B=e=>e?e.split("@")[0].charAt(0).toUpperCase():"?",M=e=>e?e.split("@")[0]:"未知",z=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",L=e=>{if(!e)return"0 B";const t=["B","KB","MB","GB"];let i=0;for(;e>=1024&&i<t.length-1;)e/=1024,i++;return`${e.toFixed(i>0?1:0)} ${t[i]}`},N=async()=>{k.value=!0;try{const e=await g.get(w);s.value=e.mail,h.value=e.attachments||[]}catch(e){console.error("加载邮件详情失败:",e),u.error("加载邮件详情失败")}finally{k.value=!1}},R=async()=>{try{await g.toggleStar(w),s.value.isStarred=!s.value.isStarred}catch(e){console.error("切换星标失败:",e),u.error("操作失败")}},x=async()=>{try{await le.confirm("确定要删除这封邮件吗？","确认删除",{type:"warning"}),await g.delete(w),u.success("删除成功"),A.back()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),u.error("删除失败"))}},D=()=>{window.print()},$=async e=>{try{const t=await re.download(e.id),i=window.URL.createObjectURL(new Blob([t.data])),o=document.createElement("a");o.href=i,o.download=e.fileName,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(i)}catch(t){console.error("下载失败:",t),u.error("下载失败")}},j=async()=>{if(!v.value.trim()){u.warning("请输入回复内容");return}b.value=!0;try{const e=localStorage.getItem("userId");await g.send({userId:e,toAddress:s.value.fromAddress,subject:`Re: ${s.value.subject||"(无主题)"}`,content:v.value,plainContent:v.value}),u.success("回复发送成功"),v.value=""}catch(e){console.error("回复失败:",e),u.error("回复发送失败")}finally{b.value=!1}};return H(()=>{N()}),(e,t)=>{const i=f("el-icon"),o=f("el-button"),I=f("el-button-group"),T=f("el-avatar"),V=f("el-input"),E=f("el-empty");return p(),m("div",ie,[k.value?(p(),m("div",ce,[n(i,{class:"is-loading",size:32},{default:r(()=>[n(l(Z))]),_:1}),t[3]||(t[3]=a("span",null,"加载中...",-1))])):s.value?(p(),m(C,{key:1},[a("div",de,[n(o,{icon:l(O),onClick:t[0]||(t[0]=d=>e.$router.back())},{default:r(()=>[...t[4]||(t[4]=[_("返回",-1)])]),_:1},8,["icon"]),n(I,null,{default:r(()=>[n(o,{icon:l(ee),onClick:x},{default:r(()=>[...t[5]||(t[5]=[_("删除",-1)])]),_:1},8,["icon"]),n(o,{icon:l(te)},{default:r(()=>[...t[6]||(t[6]=[_("移动",-1)])]),_:1},8,["icon"]),n(o,{icon:l(ae),onClick:D},{default:r(()=>[...t[7]||(t[7]=[_("打印",-1)])]),_:1},8,["icon"])]),_:1}),a("div",ue,[n(o,{icon:l(P),circle:""},null,8,["icon"]),n(o,{icon:l(q),circle:""},null,8,["icon"])])]),a("div",_e,[a("div",me,[a("h1",pe,c(s.value.subject||"(无主题)"),1),a("div",ve,[n(T,{size:48},{default:r(()=>[_(c(B(s.value.fromAddress)),1)]),_:1}),a("div",fe,[a("div",he,[a("span",ye,c(M(s.value.fromAddress)),1),a("span",ge,"<"+c(s.value.fromAddress)+">",1)]),a("div",we,[a("span",null,"收件人："+c(s.value.toAddress),1),a("span",ke,c(z(s.value.receiveTime||s.value.sendTime)),1)])]),n(o,{icon:s.value.isStarred?l(K):l(Q),class:J({starred:s.value.isStarred}),circle:"",onClick:R},null,8,["icon","class"])])]),a("div",{class:"mail-body",innerHTML:s.value.content||s.value.plainContent},null,8,be),h.value&&h.value.length>0?(p(),m("div",Ce,[a("div",Se,[n(i,null,{default:r(()=>[n(l(ne))]),_:1}),a("span",null,"附件 ("+c(h.value.length)+")",1)]),a("div",Ae,[(p(!0),m(C,null,W(h.value,d=>(p(),m("div",{class:"attachment-item",key:d.id},[n(i,{size:32,color:"#409EFF"},{default:r(()=>[n(l(se))]),_:1}),a("div",Be,[a("span",Me,c(d.fileName),1),a("span",ze,c(L(d.fileSize)),1)]),n(o,{type:"primary",link:"",icon:l(oe),onClick:$e=>$(d)},{default:r(()=>[...t[8]||(t[8]=[_("下载",-1)])]),_:1},8,["icon","onClick"])]))),128))])])):G("",!0),a("div",Le,[n(V,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=d=>v.value=d),type:"textarea",rows:3,placeholder:"快速回复..."},null,8,["modelValue"]),a("div",Ne,[n(o,{type:"primary",icon:l(X),onClick:j,loading:b.value},{default:r(()=>[...t[9]||(t[9]=[_("发送",-1)])]),_:1},8,["icon","loading"])])])])],64)):(p(),m("div",Re,[n(E,{description:"邮件不存在或已被删除"}),n(o,{type:"primary",onClick:t[2]||(t[2]=d=>e.$router.back())},{default:r(()=>[...t[10]||(t[10]=[_("返回",-1)])]),_:1})]))])}}},Te=F(xe,[["__scopeId","data-v-bc181eb0"]]);export{Te as default};
