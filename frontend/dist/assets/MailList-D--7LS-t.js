import{_ as J,r as u,i as k,j as O,n as q,k as Q,c as i,o as l,e as r,s as z,b as o,w as d,d as _,f as c,C as W,F as X,D as Z,E as f,u as ee,G as te,h as D,y as se,H as ae,I as ne,J as F,K as R,p as V,L as oe,M as le,z as w,N as re,O as ie}from"./index-Dwetklps.js";import{m as b}from"./mail-BVuPHEDu.js";const ce={class:"mail-list-container"},ue={class:"toolbar"},de={class:"toolbar-left"},_e={class:"toolbar-right"},ge={key:0,class:"loading-container"},pe={key:1,class:"empty-container"},fe={key:2,class:"mail-list"},ve=["onClick"],he={class:"mail-sender"},me={class:"mail-content"},ye={class:"mail-subject"},ke={class:"mail-preview"},we={key:0,class:"mail-attachment"},be={class:"mail-time"},Ce={key:3,class:"pagination"},xe={__name:"MailList",setup(Me){const A=ee(),L=O(),v=u(""),$=u(1),I=u(20),n=u([]),N=u(!1),g=u(!1),p=u([]);k(()=>localStorage.getItem("userId"));const C=k(()=>{const t=L.path;return t.includes("/inbox")?"inbox":t.includes("/sent")?"sent":t.includes("/drafts")?"drafts":t.includes("/trash")?"trash":t.includes("/starred")?"starred":"inbox"}),h=k(()=>{let t=p.value;if(C.value==="starred"&&(t=t.filter(e=>e.isStarred)),v.value){const e=v.value.toLowerCase();t=t.filter(s=>s.subject&&s.subject.toLowerCase().includes(e)||s.fromAddress&&s.fromAddress.toLowerCase().includes(e)||s.plainContent&&s.plainContent.toLowerCase().includes(e))}return t});k(()=>n.value.length>0&&n.value.length<h.value.length);const T=t=>(t.plainContent||t.content||"").replace(/<[^>]*>/g,"").substring(0,100),j=t=>{if(!t)return"";const e=new Date(t),s=new Date,y=new Date(s.getFullYear(),s.getMonth(),s.getDate()),x=new Date(y.getTime()-24*60*60*1e3);return e>=y?e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):e>=x?"昨天":e.getFullYear()===s.getFullYear()?`${e.getMonth()+1}月${e.getDate()}日`:`${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()}`},m=async()=>{const t=localStorage.getItem("userId");if(!t){f.warning("请先登录"),A.push("/login");return}g.value=!0;try{const e=C.value==="starred"?"":C.value,s=await b.list(t,e);p.value=Array.isArray(s)?s:[]}catch(e){console.error("加载邮件失败:",e),f.error("加载邮件失败")}finally{g.value=!1}},B=(t,e)=>{e?n.value.push(t):n.value=n.value.filter(s=>s!==t),N.value=n.value.length===h.value.length},E=async t=>{if(!t.isRead)try{await b.markAsRead(t.id),t.isRead=!0}catch(e){console.error("标记已读失败:",e)}A.push(`/mail/${t.id}`)},Y=async t=>{try{await b.toggleStar(t.id),t.isStarred=!t.isStarred}catch(e){console.error("切换星标失败:",e),f.error("操作失败")}},P=()=>{m()},K=async()=>{if(n.value.length!==0)try{await ie.confirm(`确定要删除选中的 ${n.value.length} 封邮件吗？`,"确认删除",{type:"warning"}),await b.batchDelete(n.value),f.success("删除成功"),n.value=[],m()}catch(t){t!=="cancel"&&(console.error("删除失败:",t),f.error("删除失败"))}};return q(()=>L.path,()=>{m()}),Q(()=>{m()}),(t,e)=>{const s=_("el-button"),y=_("el-button-group"),x=_("el-input"),M=_("el-icon"),U=_("el-empty"),G=_("el-checkbox"),H=_("el-pagination");return l(),i("div",ce,[r("div",ue,[r("div",de,[o(y,null,{default:d(()=>[o(s,{icon:c(te),onClick:P,loading:g.value},{default:d(()=>[...e[3]||(e[3]=[D("刷新",-1)])]),_:1},8,["icon","loading"]),o(s,{icon:c(se),onClick:K,disabled:n.value.length===0},{default:d(()=>[...e[4]||(e[4]=[D("删除",-1)])]),_:1},8,["icon","disabled"]),o(s,{icon:c(ae)},{default:d(()=>[...e[5]||(e[5]=[D("移动",-1)])]),_:1},8,["icon"])]),_:1})]),r("div",_e,[o(x,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),placeholder:"搜索邮件","prefix-icon":c(W),style:{width:"240px"},clearable:""},null,8,["modelValue","prefix-icon"])])]),g.value&&p.value.length===0?(l(),i("div",ge,[o(M,{class:"is-loading",size:32},{default:d(()=>[o(c(ne))]),_:1}),e[6]||(e[6]=r("span",null,"加载中...",-1))])):!g.value&&h.value.length===0?(l(),i("div",pe,[o(U,{description:"暂无邮件"})])):(l(),i("div",fe,[(l(!0),i(X,null,Z(h.value,a=>(l(),i("div",{key:a.id,class:F(["mail-item",{unread:!a.isRead,selected:n.value.includes(a.id)}]),onClick:S=>E(a)},[o(G,{"model-value":n.value.includes(a.id),onChange:S=>B(a.id,S),onClick:e[1]||(e[1]=R(()=>{},["stop"]))},null,8,["model-value","onChange"]),o(M,{class:F(["star-icon",{starred:a.isStarred}]),onClick:R(S=>Y(a),["stop"])},{default:d(()=>[a.isStarred?(l(),V(c(oe),{key:0})):(l(),V(c(le),{key:1}))]),_:2},1032,["class","onClick"]),r("div",he,w(a.fromAddress),1),r("div",me,[r("span",ye,w(a.subject||"(无主题)"),1),r("span",ke," - "+w(T(a)),1)]),a.hasAttachment?(l(),i("div",we,[o(M,null,{default:d(()=>[o(c(re))]),_:1})])):z("",!0),r("div",be,w(j(a.receiveTime||a.sendTime)),1)],10,ve))),128))])),p.value.length>0?(l(),i("div",Ce,[o(H,{"current-page":$.value,"onUpdate:currentPage":e[2]||(e[2]=a=>$.value=a),"page-size":I.value,total:p.value.length,layout:"prev, pager, next, total",background:""},null,8,["current-page","page-size","total"])])):z("",!0)])}}},Ae=J(xe,[["__scopeId","data-v-ad418fcf"]]);export{Ae as default};
