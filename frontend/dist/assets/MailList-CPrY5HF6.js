import{_ as O,r as u,i as w,j as Q,n as q,k as W,F as X,c as i,o as l,e as r,s as E,b as o,w as d,d as _,f as c,G as Z,H as ee,I as te,E as f,u as se,J as ne,h as S,z as ae,K as oe,L as le,M as F,N as V,p as B,x as re,O as ie,A as k,P as ce,Q as ue}from"./index-BmJWLm72.js";import{m as b}from"./mail-BVuPHEDu.js";const de={class:"mail-list-container"},_e={class:"toolbar"},ge={class:"toolbar-left"},pe={class:"toolbar-right"},fe={key:0,class:"loading-container"},ve={key:1,class:"empty-container"},he={key:2,class:"mail-list"},me=["onClick"],ye={class:"mail-sender"},we={class:"mail-content"},ke={class:"mail-subject"},be={class:"mail-preview"},Ce={key:0,class:"mail-attachment"},xe={class:"mail-time"},Me={key:3,class:"pagination"},Se={__name:"MailList",setup(Le){const L=se(),A=Q(),v=u(""),D=u(1),I=u(20),a=u([]),N=u(!1),g=u(!1),p=u([]);w(()=>localStorage.getItem("userId"));const $=w(()=>{const t=A.path;return t.includes("/inbox")?"inbox":t.includes("/sent")?"sent":t.includes("/drafts")?"drafts":t.includes("/trash")?"trash":t.includes("/starred")?"starred":"inbox"}),h=w(()=>{let t=p.value;if($.value==="starred"&&(t=t.filter(e=>e.isStarred)),v.value){const e=v.value.toLowerCase();t=t.filter(n=>n.subject&&n.subject.toLowerCase().includes(e)||n.fromAddress&&n.fromAddress.toLowerCase().includes(e)||n.plainContent&&n.plainContent.toLowerCase().includes(e))}return t});w(()=>a.value.length>0&&a.value.length<h.value.length);const T=t=>(t.plainContent||t.content||"").replace(/<[^>]*>/g,"").substring(0,100),j=t=>{if(!t)return"";const e=new Date(t),n=new Date,y=new Date(n.getFullYear(),n.getMonth(),n.getDate()),C=new Date(y.getTime()-24*60*60*1e3);return e>=y?e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):e>=C?"昨天":e.getFullYear()===n.getFullYear()?`${e.getMonth()+1}月${e.getDate()}日`:`${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()}`},m=async()=>{const t=localStorage.getItem("userId");if(!t){f.warning("请先登录"),L.push("/login");return}g.value=!0;try{const e=await b.list(t,$.value);p.value=Array.isArray(e)?e:[]}catch(e){console.error("加载邮件失败:",e),f.error("加载邮件失败")}finally{g.value=!1}},P=(t,e)=>{e?a.value.push(t):a.value=a.value.filter(n=>n!==t),N.value=a.value.length===h.value.length},Y=async t=>{if(!t.isRead)try{await b.markAsRead(t.id),t.isRead=!0}catch(e){console.error("标记已读失败:",e)}L.push(`/mail/${t.id}`)},U=async t=>{try{await b.toggleStar(t.id),t.isStarred=!t.isStarred}catch(e){console.error("切换星标失败:",e),f.error("操作失败")}},R=async()=>{await m()},z=()=>{R()},K=async()=>{if(a.value.length!==0)try{await ue.confirm(`确定要删除选中的 ${a.value.length} 封邮件吗？`,"确认删除",{type:"warning"}),await b.batchDelete(a.value),f.success("删除成功"),a.value=[],m()}catch(t){t!=="cancel"&&(console.error("删除失败:",t),f.error("删除失败"))}};return q(()=>A.path,()=>{m()}),W(()=>{m(),window.addEventListener("mail-refresh",z)}),X(()=>{window.removeEventListener("mail-refresh",z)}),(t,e)=>{const n=_("el-button"),y=_("el-button-group"),C=_("el-input"),x=_("el-icon"),G=_("el-empty"),H=_("el-checkbox"),J=_("el-pagination");return l(),i("div",de,[r("div",_e,[r("div",ge,[o(y,null,{default:d(()=>[o(n,{icon:c(ne),onClick:R,loading:g.value},{default:d(()=>[...e[3]||(e[3]=[S("刷新",-1)])]),_:1},8,["icon","loading"]),o(n,{icon:c(ae),onClick:K,disabled:a.value.length===0},{default:d(()=>[...e[4]||(e[4]=[S("删除",-1)])]),_:1},8,["icon","disabled"]),o(n,{icon:c(oe)},{default:d(()=>[...e[5]||(e[5]=[S("移动",-1)])]),_:1},8,["icon"])]),_:1})]),r("div",pe,[o(C,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),placeholder:"搜索邮件","prefix-icon":c(Z),style:{width:"240px"},clearable:""},null,8,["modelValue","prefix-icon"])])]),g.value&&p.value.length===0?(l(),i("div",fe,[o(x,{class:"is-loading",size:32},{default:d(()=>[o(c(le))]),_:1}),e[6]||(e[6]=r("span",null,"加载中...",-1))])):!g.value&&h.value.length===0?(l(),i("div",ve,[o(G,{description:"暂无邮件"})])):(l(),i("div",he,[(l(!0),i(ee,null,te(h.value,s=>(l(),i("div",{key:s.id,class:F(["mail-item",{unread:!s.isRead,selected:a.value.includes(s.id)}]),onClick:M=>Y(s)},[o(H,{"model-value":a.value.includes(s.id),onChange:M=>P(s.id,M),onClick:e[1]||(e[1]=V(()=>{},["stop"]))},null,8,["model-value","onChange"]),o(x,{class:F(["star-icon",{starred:s.isStarred}]),onClick:V(M=>U(s),["stop"])},{default:d(()=>[s.isStarred?(l(),B(c(re),{key:0})):(l(),B(c(ie),{key:1}))]),_:2},1032,["class","onClick"]),r("div",ye,k(s.fromAddress),1),r("div",we,[r("span",ke,k(s.subject||"(无主题)"),1),r("span",be," - "+k(T(s)),1)]),s.hasAttachment?(l(),i("div",Ce,[o(x,null,{default:d(()=>[o(c(ce))]),_:1})])):E("",!0),r("div",xe,k(j(s.receiveTime||s.sendTime)),1)],10,me))),128))])),p.value.length>0?(l(),i("div",Me,[o(J,{"current-page":D.value,"onUpdate:currentPage":e[2]||(e[2]=s=>D.value=s),"page-size":I.value,total:p.value.length,layout:"prev, pager, next, total",background:""},null,8,["current-page","page-size","total"])])):E("",!0)])}}},$e=O(Se,[["__scopeId","data-v-0d3cc107"]]);export{$e as default};
