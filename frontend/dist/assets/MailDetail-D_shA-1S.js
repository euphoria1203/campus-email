import{_ as Q,j as J,r as y,i as D,k as W,c,o as u,b as n,e as s,w as i,d as f,H as x,f as r,R as X,S as Y,D as Z,s as A,A as _,M as ee,x as te,O as ae,I as se,v as B,E as d,u as ne,L as oe,h as m,z as le,K as re,T as ie,P as de,y as ce,U as ue,Q as _e}from"./index-DvDTU7Me.js";import{m as g,b as me}from"./mail-pa6lI-PL.js";const ve={class:"mail-detail-container"},fe={key:0,class:"loading-container"},pe={class:"detail-toolbar"},ye={class:"nav-buttons"},he={class:"mail-content"},ge={class:"mail-header"},we={class:"mail-subject"},ke={class:"mail-meta"},be={class:"meta-info"},Ce={class:"sender-line"},Ae={class:"sender-name"},Se={class:"sender-email"},De={class:"recipient-line"},xe={class:"mail-time"},Be=["innerHTML"],Me={key:0,class:"mail-attachments"},ze={class:"attachments-header"},Le={class:"attachment-list"},Re={class:"attachment-info"},Ie={class:"attachment-name"},Ne={class:"attachment-size"},Te={key:1,class:"draft-actions"},$e={class:"draft-buttons"},je={key:2,class:"quick-reply"},Ue={class:"reply-actions"},Ve={key:2,class:"empty-container"},Ee={__name:"MailDetail",setup(Fe){const M=J(),S=ne(),w=M.params.id,k=y(!0),b=y(!1),C=y(!1),a=y(null),h=y([]),p=y(""),z=D(()=>{var e;return((e=a.value)==null?void 0:e.folder)==="inbox"}),L=D(()=>{var e;return((e=a.value)==null?void 0:e.folder)==="drafts"}),R=e=>e?e.split("@")[0].charAt(0).toUpperCase():"?",I=e=>e?e.split("@")[0]:"未知",N=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",T=e=>{if(!e)return"0 B";const t=["B","KB","MB","GB"];let l=0;for(;e>=1024&&l<t.length-1;)e/=1024,l++;return`${e.toFixed(l>0?1:0)} ${t[l]}`},$=async()=>{k.value=!0;try{const e=await g.get(w);a.value=e.mail,h.value=e.attachments||[]}catch(e){console.error("加载邮件详情失败:",e),d.error("加载邮件详情失败")}finally{k.value=!1}},j=async()=>{try{await g.toggleStar(w),a.value.isStarred=!a.value.isStarred}catch(e){console.error("切换星标失败:",e),d.error("操作失败")}},U=async()=>{try{await _e.confirm("确定要删除这封邮件吗？","确认删除",{type:"warning"}),await g.delete(w),d.success("删除成功"),S.back()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),d.error("删除失败"))}},V=()=>{window.print()},E=async e=>{try{const t=await me.download(e.id),l=window.URL.createObjectURL(new Blob([t.data])),o=document.createElement("a");o.href=l,o.download=e.fileName,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(l)}catch(t){console.error("下载失败:",t),d.error("下载失败")}},F=async()=>{if(!p.value.trim()){d.warning("请输入回复内容");return}b.value=!0;try{const e=localStorage.getItem("userId");await g.send({userId:e,toAddress:a.value.fromAddress,subject:`Re: ${a.value.subject||"(无主题)"}`,content:p.value,plainContent:p.value}),d.success("回复发送成功"),p.value=""}catch(e){console.error("回复失败:",e),d.error("回复发送失败")}finally{b.value=!1}},H=async()=>{var e,t;if(a.value){if(!a.value.toAddress||!a.value.toAddress.trim()){d.warning("草稿缺少收件人，无法发送");return}C.value=!0;try{await g.sendDraft(a.value.id),d.success("草稿发送成功"),a.value.folder="sent",S.push("/sent")}catch(l){console.error("草稿发送失败:",l),d.error(((t=(e=l.response)==null?void 0:e.data)==null?void 0:t.message)||"草稿发送失败")}finally{C.value=!1}}};return W(()=>{$()}),(e,t)=>{const l=f("el-icon"),o=f("el-button"),O=f("el-button-group"),K=f("el-avatar"),P=f("el-alert"),q=f("el-input"),G=f("el-empty");return u(),c("div",ve,[k.value?(u(),c("div",fe,[n(l,{class:"is-loading",size:32},{default:i(()=>[n(r(oe))]),_:1}),t[3]||(t[3]=s("span",null,"加载中...",-1))])):a.value?(u(),c(x,{key:1},[s("div",pe,[n(o,{icon:r(X),onClick:t[0]||(t[0]=v=>e.$router.back())},{default:i(()=>[...t[4]||(t[4]=[m("返回",-1)])]),_:1},8,["icon"]),n(O,null,{default:i(()=>[n(o,{icon:r(le),onClick:U},{default:i(()=>[...t[5]||(t[5]=[m("删除",-1)])]),_:1},8,["icon"]),n(o,{icon:r(re)},{default:i(()=>[...t[6]||(t[6]=[m("移动",-1)])]),_:1},8,["icon"]),n(o,{icon:r(ie),onClick:V},{default:i(()=>[...t[7]||(t[7]=[m("打印",-1)])]),_:1},8,["icon"])]),_:1}),s("div",ye,[n(o,{icon:r(Y),circle:""},null,8,["icon"]),n(o,{icon:r(Z),circle:""},null,8,["icon"])])]),s("div",he,[s("div",ge,[s("h1",we,_(a.value.subject||"(无主题)"),1),s("div",ke,[n(K,{size:48},{default:i(()=>[m(_(R(a.value.fromAddress)),1)]),_:1}),s("div",be,[s("div",Ce,[s("span",Ae,_(I(a.value.fromAddress)),1),s("span",Se,"<"+_(a.value.fromAddress)+">",1)]),s("div",De,[s("span",null,"收件人："+_(a.value.toAddress),1),s("span",xe,_(N(a.value.receiveTime||a.value.sendTime)),1)])]),n(o,{icon:a.value.isStarred?r(te):r(ae),class:ee({starred:a.value.isStarred}),circle:"",onClick:j},null,8,["icon","class"])])]),s("div",{class:"mail-body",innerHTML:a.value.content||a.value.plainContent},null,8,Be),h.value&&h.value.length>0?(u(),c("div",Me,[s("div",ze,[n(l,null,{default:i(()=>[n(r(de))]),_:1}),s("span",null,"附件 ("+_(h.value.length)+")",1)]),s("div",Le,[(u(!0),c(x,null,se(h.value,v=>(u(),c("div",{class:"attachment-item",key:v.id},[n(l,{size:32,color:"#409EFF"},{default:i(()=>[n(r(ce))]),_:1}),s("div",Re,[s("span",Ie,_(v.fileName),1),s("span",Ne,_(T(v.fileSize)),1)]),n(o,{type:"primary",link:"",icon:r(ue),onClick:He=>E(v)},{default:i(()=>[...t[8]||(t[8]=[m("下载",-1)])]),_:1},8,["icon","onClick"])]))),128))])])):A("",!0),L.value?(u(),c("div",Te,[n(P,{type:"info",closable:!1,title:"这是草稿，确认内容无误后即可发送"}),s("div",$e,[n(o,{type:"primary",icon:r(B),loading:C.value,onClick:H},{default:i(()=>[...t[9]||(t[9]=[m("发送草稿",-1)])]),_:1},8,["icon","loading"])])])):A("",!0),z.value?(u(),c("div",je,[n(q,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=v=>p.value=v),type:"textarea",rows:3,placeholder:"快速回复..."},null,8,["modelValue"]),s("div",Ue,[n(o,{type:"primary",icon:r(B),onClick:F,loading:b.value},{default:i(()=>[...t[10]||(t[10]=[m("发送",-1)])]),_:1},8,["icon","loading"])])])):A("",!0)])],64)):(u(),c("div",Ve,[n(G,{description:"邮件不存在或已被删除"}),n(o,{type:"primary",onClick:t[2]||(t[2]=v=>e.$router.back())},{default:i(()=>[...t[11]||(t[11]=[m("返回",-1)])]),_:1})]))])}}},Pe=Q(Ee,[["__scopeId","data-v-f531b230"]]);export{Pe as default};
