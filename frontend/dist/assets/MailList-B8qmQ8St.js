import{_ as X,r as v,i as m,j as Z,n as ee,k as te,F as se,c,o,e as r,s as E,b as l,w as u,d as f,f as i,G as ae,H as ne,I as oe,E as d,u as le,p as x,J as re,h as M,z as ie,A as y,K as V,L as ce,M as B,N as I,x as ue,O as de,P as ve,Q as N}from"./index-DvDTU7Me.js";import{m as g}from"./mail-pa6lI-PL.js";const fe={class:"mail-list-container"},ge={class:"toolbar"},_e={class:"toolbar-left"},pe={class:"toolbar-right"},he={key:0,class:"loading-container"},me={key:1,class:"empty-container"},ye={key:2,class:"mail-list"},we=["onClick"],ke={class:"mail-sender"},be={class:"mail-content"},Ce={class:"mail-subject"},xe={class:"mail-preview"},Me={key:0,class:"mail-attachment"},Se={class:"mail-time"},$e={key:3,class:"pagination"},Le={__name:"MailList",setup(Ae){const D=le(),R=Z(),w=v(""),F=v(1),j=v(20),s=v([]),P=v(!1),_=v(!1),p=v([]);m(()=>localStorage.getItem("userId"));const S=m(()=>{const e=R.path;return e.includes("/inbox")?"inbox":e.includes("/sent")?"sent":e.includes("/drafts")?"drafts":e.includes("/trash")?"trash":e.includes("/starred")?"starred":"inbox"}),k=m(()=>S.value==="trash"),b=m(()=>{let e=p.value;if(S.value==="starred"&&(e=e.filter(t=>t.isStarred)),w.value){const t=w.value.toLowerCase();e=e.filter(a=>a.subject&&a.subject.toLowerCase().includes(t)||a.fromAddress&&a.fromAddress.toLowerCase().includes(t)||a.plainContent&&a.plainContent.toLowerCase().includes(t))}return e});m(()=>s.value.length>0&&s.value.length<b.value.length);const Y=e=>(e.plainContent||e.content||"").replace(/<[^>]*>/g,"").substring(0,100),U=e=>{if(!e)return"";const t=new Date(e),a=new Date,C=new Date(a.getFullYear(),a.getMonth(),a.getDate()),$=new Date(C.getTime()-24*60*60*1e3);return t>=C?t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):t>=$?"昨天":t.getFullYear()===a.getFullYear()?`${t.getMonth()+1}月${t.getDate()}日`:`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}`},h=async()=>{const e=localStorage.getItem("userId");if(!e){d.warning("请先登录"),D.push("/login");return}_.value=!0;try{const t=await g.list(e,S.value);p.value=Array.isArray(t)?t:[]}catch(t){console.error("加载邮件失败:",t),d.error("加载邮件失败")}finally{_.value=!1}},K=(e,t)=>{t?s.value.push(e):s.value=s.value.filter(a=>a!==e),P.value=s.value.length===b.value.length},G=async e=>{if(!e.isRead)try{await g.markAsRead(e.id),e.isRead=!0}catch(t){console.error("标记已读失败:",t)}D.push(`/mail/${e.id}`)},H=async e=>{try{await g.toggleStar(e.id),e.isStarred=!e.isStarred}catch(t){console.error("切换星标失败:",t),d.error("操作失败")}},T=async()=>{await h()},z=()=>{T()},J=async()=>{if(s.value.length!==0)try{const e=k.value?"彻底删除":"删除";await N.confirm(`确定要${e}选中的 ${s.value.length} 封邮件吗？`,`确认${e}`,{type:"warning"}),k.value?(await g.deletePermanently(s.value),d.success("已彻底删除")):(await g.batchDelete(s.value),d.success("删除成功，已移至垃圾箱")),s.value=[],h()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),d.error("操作失败"))}},O=async()=>{if(s.value.length!==0)try{await N.confirm(`确定要将选中的 ${s.value.length} 封邮件移出垃圾箱吗？`,"移出垃圾箱",{type:"warning"}),await g.restore(s.value),d.success("已移出垃圾箱，邮件回到收件箱"),s.value=[],h()}catch(e){e!=="cancel"&&(console.error("移出垃圾箱失败:",e),d.error("移出失败"))}};return ee(()=>R.path,()=>{h()}),te(()=>{h(),window.addEventListener("mail-refresh",z)}),se(()=>{window.removeEventListener("mail-refresh",z)}),(e,t)=>{const a=f("el-button"),C=f("el-button-group"),$=f("el-input"),L=f("el-icon"),Q=f("el-empty"),q=f("el-checkbox"),W=f("el-pagination");return o(),c("div",fe,[r("div",ge,[r("div",_e,[l(C,null,{default:u(()=>[l(a,{icon:i(re),onClick:T,loading:_.value},{default:u(()=>[...t[3]||(t[3]=[M("刷新",-1)])]),_:1},8,["icon","loading"]),l(a,{icon:i(ie),onClick:J,disabled:s.value.length===0},{default:u(()=>[M(y(k.value?"彻底删除":"删除"),1)]),_:1},8,["icon","disabled"]),k.value?(o(),x(a,{key:0,icon:i(V),onClick:O,disabled:s.value.length===0},{default:u(()=>[...t[4]||(t[4]=[M("移出垃圾箱",-1)])]),_:1},8,["icon","disabled"])):(o(),x(a,{key:1,icon:i(V),disabled:""},{default:u(()=>[...t[5]||(t[5]=[M("移动",-1)])]),_:1},8,["icon"]))]),_:1})]),r("div",pe,[l($,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=n=>w.value=n),placeholder:"搜索邮件","prefix-icon":i(ae),style:{width:"240px"},clearable:""},null,8,["modelValue","prefix-icon"])])]),_.value&&p.value.length===0?(o(),c("div",he,[l(L,{class:"is-loading",size:32},{default:u(()=>[l(i(ce))]),_:1}),t[6]||(t[6]=r("span",null,"加载中...",-1))])):!_.value&&b.value.length===0?(o(),c("div",me,[l(Q,{description:"暂无邮件"})])):(o(),c("div",ye,[(o(!0),c(ne,null,oe(b.value,n=>(o(),c("div",{key:n.id,class:B(["mail-item",{unread:!n.isRead,selected:s.value.includes(n.id)}]),onClick:A=>G(n)},[l(q,{"model-value":s.value.includes(n.id),onChange:A=>K(n.id,A),onClick:t[1]||(t[1]=I(()=>{},["stop"]))},null,8,["model-value","onChange"]),l(L,{class:B(["star-icon",{starred:n.isStarred}]),onClick:I(A=>H(n),["stop"])},{default:u(()=>[n.isStarred?(o(),x(i(ue),{key:0})):(o(),x(i(de),{key:1}))]),_:2},1032,["class","onClick"]),r("div",ke,y(n.fromAddress),1),r("div",be,[r("span",Ce,y(n.subject||"(无主题)"),1),r("span",xe," - "+y(Y(n)),1)]),n.hasAttachment?(o(),c("div",Me,[l(L,null,{default:u(()=>[l(i(ve))]),_:1})])):E("",!0),r("div",Se,y(U(n.receiveTime||n.sendTime)),1)],10,we))),128))])),p.value.length>0?(o(),c("div",$e,[l(W,{"current-page":F.value,"onUpdate:currentPage":t[2]||(t[2]=n=>F.value=n),"page-size":j.value,total:p.value.length,layout:"prev, pager, next, total",background:""},null,8,["current-page","page-size","total"])])):E("",!0)])}}},Fe=X(Le,[["__scopeId","data-v-882f6472"]]);export{Fe as default};
