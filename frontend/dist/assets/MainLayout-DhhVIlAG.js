import{_ as J,r as b,i as f,j as K,k as O,n as P,p as C,o as y,w as t,d as n,u as Q,b as e,e as a,f as s,m as k,h as r,q as W,s as N,t as X,v as Y,x as Z,y as ee,z as te,A as d,B as R,C as le,D as ae,g as oe}from"./index-BmJWLm72.js";import{m as ne}from"./mail-BVuPHEDu.js";const se={class:"logo"},ue={class:"compose-btn"},re={class:"user-info"},de={class:"user-avatar"},ie={class:"username"},_e={class:"header-left"},ce={class:"page-title"},fe={class:"header-right"},me={class:"user-profile"},pe={class:"user-details"},ve={class:"user-name"},ge={class:"user-email"},he={__name:"MainLayout",setup(we){const p=Q(),v=K(),g=b(0),h=b(0),m=b(!1),V=f(()=>{var o;return((o=v.meta)==null?void 0:o.folder)||"inbox"}),$=f(()=>{var o;return((o=v.meta)==null?void 0:o.title)||"邮件"}),i=f(()=>localStorage.getItem("username")||"User"),x=f(()=>localStorage.getItem("email")||`${i.value}@campus.mail`),I=f(()=>i.value.charAt(0).toUpperCase()),w=async()=>{try{const o=localStorage.getItem("userId");if(o){const l=await ne.getStats(o);g.value=l.unreadCount||0,h.value=l.draftsCount||0}}catch(o){console.error("获取邮件统计失败:",o)}};O(()=>{w()}),P(()=>v.path,()=>{w()});const L=o=>{p.push(`/${o}`)},S=()=>{localStorage.removeItem("token"),localStorage.removeItem("userId"),localStorage.removeItem("username"),localStorage.removeItem("email"),localStorage.removeItem("nickname"),p.push("/login")},D=()=>{p.push("/accounts")},T=async()=>{if(!m.value){m.value=!0;try{await w(),window.dispatchEvent(new CustomEvent("mail-refresh"))}catch(o){console.error("刷新失败:",o)}finally{m.value=!1}}};return(o,l)=>{const u=n("el-icon"),M=n("el-button"),z=n("el-badge"),_=n("el-menu-item"),U=n("el-menu"),A=n("el-avatar"),c=n("el-dropdown-item"),B=n("el-dropdown-menu"),E=n("el-dropdown"),j=n("el-aside"),q=n("el-header"),G=n("router-view"),H=n("el-main"),F=n("el-container");return y(),C(F,{class:"main-layout"},{default:t(()=>[e(j,{width:"220px",class:"sidebar"},{default:t(()=>[a("div",se,[e(u,{size:28,color:"#409EFF"},{default:t(()=>[e(s(k))]),_:1}),l[1]||(l[1]=a("span",null,"Campus Mail",-1))]),a("div",ue,[e(M,{type:"primary",size:"large",onClick:l[0]||(l[0]=be=>o.$router.push("/compose"))},{default:t(()=>[e(u,null,{default:t(()=>[e(s(W))]),_:1}),l[2]||(l[2]=r(" 写邮件 ",-1))]),_:1})]),e(U,{"default-active":V.value,class:"folder-menu",onSelect:L},{default:t(()=>[e(_,{index:"inbox"},{default:t(()=>[e(u,null,{default:t(()=>[e(s(X))]),_:1}),l[3]||(l[3]=a("span",null,"收件箱",-1)),g.value>0?(y(),C(z,{key:0,value:g.value,class:"folder-badge"},null,8,["value"])):N("",!0)]),_:1}),e(_,{index:"sent"},{default:t(()=>[e(u,null,{default:t(()=>[e(s(Y))]),_:1}),l[4]||(l[4]=a("span",null,"发件箱",-1))]),_:1}),e(_,{index:"starred"},{default:t(()=>[e(u,null,{default:t(()=>[e(s(Z))]),_:1}),l[5]||(l[5]=a("span",null,"星标邮件",-1))]),_:1}),e(_,{index:"drafts"},{default:t(()=>[e(u,null,{default:t(()=>[e(s(ee))]),_:1}),l[6]||(l[6]=a("span",null,"草稿箱",-1)),h.value>0?(y(),C(z,{key:0,value:h.value,class:"folder-badge",type:"info"},null,8,["value"])):N("",!0)]),_:1}),e(_,{index:"trash"},{default:t(()=>[e(u,null,{default:t(()=>[e(s(te))]),_:1}),l[7]||(l[7]=a("span",null,"垃圾箱",-1))]),_:1})]),_:1},8,["default-active"]),a("div",re,[e(E,{trigger:"click"},{dropdown:t(()=>[e(B,null,{default:t(()=>[e(c,{onClick:D},{default:t(()=>[e(u,null,{default:t(()=>[e(s(k))]),_:1}),l[8]||(l[8]=r(" 邮箱账号管理 ",-1))]),_:1}),e(c,{onClick:S},{default:t(()=>[e(u,null,{default:t(()=>[e(s(R))]),_:1}),l[9]||(l[9]=r(" 退出登录 ",-1))]),_:1})]),_:1})]),default:t(()=>[a("div",de,[e(A,{size:36},{default:t(()=>[r(d(I.value),1)]),_:1}),a("span",ie,d(i.value),1)])]),_:1})])]),_:1}),e(F,{class:"right-container"},{default:t(()=>[e(q,{class:"top-header"},{default:t(()=>[a("div",_e,[a("span",ce,d($.value),1)]),a("div",fe,[e(M,{class:"refresh-btn",icon:s(le),circle:"",plain:"",loading:m.value,onClick:T,title:"刷新邮件"},null,8,["icon","loading"]),e(E,{trigger:"click"},{dropdown:t(()=>[e(B,null,{default:t(()=>[e(c,{disabled:""},{default:t(()=>[e(u,null,{default:t(()=>[e(s(oe))]),_:1}),r(" "+d(i.value),1)]),_:1}),e(c,{disabled:""},{default:t(()=>[e(u,null,{default:t(()=>[e(s(k))]),_:1}),r(" "+d(x.value),1)]),_:1}),e(c,{divided:"",onClick:S},{default:t(()=>[e(u,null,{default:t(()=>[e(s(R))]),_:1}),l[10]||(l[10]=r(" 退出登录 ",-1))]),_:1})]),_:1})]),default:t(()=>[a("div",me,[e(A,{size:32},{default:t(()=>[r(d(I.value),1)]),_:1}),a("div",pe,[a("span",ve,d(i.value),1),a("span",ge,d(x.value),1)]),e(u,null,{default:t(()=>[e(s(ae))]),_:1})])]),_:1})])]),_:1}),e(H,{class:"main-content"},{default:t(()=>[e(G)]),_:1})]),_:1})]),_:1})}}},ke=J(he,[["__scopeId","data-v-d9324151"]]);export{ke as default};
