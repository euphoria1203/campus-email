import{_ as b,r as _,a as h,c as S,o as z,b as s,w as a,d as t,u as C,e as l,f as m,g as E,l as B,h as f,m as L,E as g}from"./index-3Ry6G3R-.js";import{a as N}from"./mail-2KPGBgEm.js";const R={class:"login-container"},q={class:"card-header"},F={class:"login-footer"},M={__name:"Login",setup(T){const w=C(),c=_(null),n=_(!1),r=h({username:"",password:""}),k={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},v=async()=>{var u,e;try{await c.value.validate(),n.value=!0;const o=await N.login({username:r.username,password:r.password});console.log("登录响应:",o),localStorage.setItem("token",o.token),localStorage.setItem("userId",o.userId),localStorage.setItem("username",o.username),localStorage.setItem("email",o.email),localStorage.setItem("nickname",o.nickname||o.username),g.success("登录成功"),setTimeout(()=>{w.push("/inbox")},100)}catch(o){console.error("登录失败:",o),g.error(((e=(u=o.response)==null?void 0:u.data)==null?void 0:e.message)||"登录失败，请检查用户名或密码")}finally{n.value=!1}};return(u,e)=>{const o=t("el-icon"),p=t("el-input"),d=t("el-form-item"),x=t("el-button"),V=t("router-link"),y=t("el-form"),I=t("el-card");return z(),S("div",R,[s(I,{class:"login-card"},{header:a(()=>[l("div",q,[s(o,{size:32,color:"#409EFF"},{default:a(()=>[s(m(L))]),_:1}),e[2]||(e[2]=l("h2",null,"Campus Mail",-1))])]),default:a(()=>[s(y,{model:r,rules:k,ref_key:"formRef",ref:c,"label-width":"0"},{default:a(()=>[s(d,{prop:"username"},{default:a(()=>[s(p,{modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=i=>r.username=i),placeholder:"用户名","prefix-icon":m(E),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),s(d,{prop:"password"},{default:a(()=>[s(p,{modelValue:r.password,"onUpdate:modelValue":e[1]||(e[1]=i=>r.password=i),type:"password",placeholder:"密码","prefix-icon":m(B),size:"large","show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),s(d,null,{default:a(()=>[s(x,{type:"primary",size:"large",style:{width:"100%"},loading:n.value,onClick:v},{default:a(()=>[...e[3]||(e[3]=[f(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1}),l("div",F,[e[5]||(e[5]=l("span",null,"还没有账号？",-1)),s(V,{to:"/register"},{default:a(()=>[...e[4]||(e[4]=[f("立即注册",-1)])]),_:1})])]),_:1},8,["model"])]),_:1})])}}},j=b(M,[["__scopeId","data-v-0e625e16"]]);export{j as default};
