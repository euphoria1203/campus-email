import{d as _}from"./mail-2KPGBgEm.js";import{_ as R,r as p,k as q,c as O,o as v,b as l,w as t,d as s,a0 as h,a1 as j,p as g,s as D,h as u,e as A,E as f,O as F}from"./index-3Ry6G3R-.js";const G={class:"mail-account-manage"},J={class:"card-header"},K={__name:"MailAccountManage",setup(L){const V=p([]),y=p(!1),d=p(!1),k=p(null),o=p({emailAddress:"",displayName:"",smtpHost:"",smtpPort:25,isDefault:!1}),M={emailAddress:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"邮箱格式不正确",trigger:"blur"}]},b=Number(localStorage.getItem("userId")||0),c=async()=>{if(b){y.value=!0;try{const n=await _.listByUser(b);V.value=n||[]}finally{y.value=!1}}},C=()=>{o.value={emailAddress:"",displayName:"",smtpHost:"",smtpPort:25,isDefault:!1},d.value=!0},N=()=>{k.value.validate(async n=>{if(n)try{await _.create({...o.value,userId:b}),f.success("新增邮箱账号成功"),d.value=!1,c()}catch{f.error("新增失败，请稍后重试")}})},P=async n=>{try{await _.update(n.id,{...n,isDefault:!0}),f.success("已设为默认邮箱"),c()}catch{f.error("操作失败，请稍后重试")}},x=async n=>{try{await F.confirm("确定要删除该邮箱账号吗？","提示",{type:"warning"}),await _.remove(n.id),f.success("删除成功"),c()}catch{}};return q(()=>{c()}),(n,e)=>{const i=s("el-button"),r=s("el-table-column"),S=s("el-tag"),U=s("el-table"),B=s("el-card"),w=s("el-input"),m=s("el-form-item"),H=s("el-input-number"),T=s("el-switch"),z=s("el-form"),E=s("el-dialog"),I=h("loading");return v(),O("div",G,[l(B,{shadow:"never"},{header:t(()=>[A("div",J,[e[8]||(e[8]=A("span",null,"邮箱账号管理",-1)),l(i,{type:"primary",size:"small",onClick:C},{default:t(()=>[...e[7]||(e[7]=[u("新增邮箱账号",-1)])]),_:1})])]),default:t(()=>[j((v(),g(U,{data:V.value,style:{width:"100%"}},{default:t(()=>[l(r,{prop:"emailAddress",label:"邮箱地址","min-width":"220"}),l(r,{prop:"displayName",label:"显示名称","min-width":"160"}),l(r,{prop:"smtpHost",label:"SMTP 服务器","min-width":"160"}),l(r,{prop:"smtpPort",label:"SMTP 端口",width:"120"}),l(r,{prop:"isDefault",label:"默认",width:"80"},{default:t(a=>[a.row.isDefault?(v(),g(S,{key:0,type:"success",size:"small"},{default:t(()=>[...e[9]||(e[9]=[u("默认",-1)])]),_:1})):D("",!0)]),_:1}),l(r,{label:"操作",width:"200"},{default:t(a=>[a.row.isDefault?D("",!0):(v(),g(i,{key:0,type:"primary",link:"",size:"small",onClick:$=>P(a.row)},{default:t(()=>[...e[10]||(e[10]=[u("设为默认",-1)])]),_:1},8,["onClick"])),l(i,{type:"danger",link:"",size:"small",onClick:$=>x(a.row)},{default:t(()=>[...e[11]||(e[11]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[I,y.value]])]),_:1}),l(E,{modelValue:d.value,"onUpdate:modelValue":e[6]||(e[6]=a=>d.value=a),title:"新增邮箱账号",width:"500px"},{footer:t(()=>[l(i,{onClick:e[5]||(e[5]=a=>d.value=!1)},{default:t(()=>[...e[12]||(e[12]=[u("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:N},{default:t(()=>[...e[13]||(e[13]=[u("保存",-1)])]),_:1})]),default:t(()=>[l(z,{model:o.value,rules:M,ref_key:"formRef",ref:k,"label-width":"100px"},{default:t(()=>[l(m,{label:"邮箱地址",prop:"emailAddress"},{default:t(()=>[l(w,{modelValue:o.value.emailAddress,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.emailAddress=a),placeholder:"例如：user@example.com"},null,8,["modelValue"])]),_:1}),l(m,{label:"显示名称",prop:"displayName"},{default:t(()=>[l(w,{modelValue:o.value.displayName,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.displayName=a),placeholder:"发件人显示名称，可选"},null,8,["modelValue"])]),_:1}),l(m,{label:"SMTP 服务器",prop:"smtpHost"},{default:t(()=>[l(w,{modelValue:o.value.smtpHost,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.smtpHost=a),placeholder:"默认使用系统 SMTP，可留空"},null,8,["modelValue"])]),_:1}),l(m,{label:"SMTP 端口",prop:"smtpPort"},{default:t(()=>[l(H,{modelValue:o.value.smtpPort,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.smtpPort=a),min:1,max:65535,controls:!1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(m,{label:"设为默认",prop:"isDefault"},{default:t(()=>[l(T,{modelValue:o.value.isDefault,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.isDefault=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},X=R(K,[["__scopeId","data-v-24cfdcb9"]]);export{X as default};
